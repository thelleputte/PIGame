<!DOCTYPE html>
<html lang="fr">

<head>

	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"> -->
	<meta name="description" content="My first mockup of PIGame" />
	<meta name="author" content="The geeks du dimanche">
	<link rel="icon" href="img/pig_pixel.png">

	<title>PIGame mockup1</title>

	<!-- Bootstrap core CSS -->
	<link href="dist/css/bootstrap.min.css" rel="stylesheet">
	<!-- Custom styles for this template -->
	<link href="pig.css" rel="stylesheet">

<!-- IE10 viewport hack for Surface/desktop Windows 8 bug 
    <link href="assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet">
-->

<!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
<!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]
    <script src="../../assets/js/ie-emulation-modes-warning.js"></script>
-->

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
      <![endif]-->

<!--  For PhoneGap build
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
-->

<style type="text/css">
	body{
		background-color: lightgrey;
	}

	h1:hover{
		text-shadow: 0px 0px 20px blue;
	}

	.glow{
		text-shadow: 0px 0px 20px blue;
	}

	.hidden {
		display: none;
	}

	.progress-bar-perso {
		background-color: pink;
	}

	img{
		width: 48px;
		cursor: pointer;
		/*padding: 10px;*/
		/* border:1px solid #fff;*/
		margin-right: 20px;
	}

	img:hover{
		-webkit-border-radius: 10px;
		-moz-border-radius: 10px;
		border-radius: 10px;
		-webkit-box-shadow: 0px 0px 30px 0px rgba(0, 255, 0, 0.67);
		-moz-box-shadow:    0px 0px 30px 0px rgba(0, 255, 0, 0.67);
		box-shadow:         0px 0px 30px 0px rgba(0, 255, 0, 0.67);
	}
	img:last-of-type:hover{
		-webkit-border-radius: 10px;
		-moz-border-radius: 10px;
		border-radius: 10px;
		-webkit-box-shadow: 0px 0px 30px 0px rgba(232, 0, 0, 0.67);
		-moz-box-shadow:    0px 0px 30px 0px rgba(232, 0, 0, 0.67);
		box-shadow:         0px 0px 30px 0px rgba(232, 0, 0, 0.67);
	}
</style>

</head>

<body>

	<nav class="navbar navbar-pigame navbar-fixed-top">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
					<span class="sr-only">Toggle navigation</span> 
					<span class="icon-bar"></span> 
					<span class="icon-bar"></span> 
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="#"> 
				<!-- <span class="glyphicon glyphicon-eye-open"></span>-->
				PIGame
				</a>
			</div>
			<div id="navbar" class="collapse navbar-collapse">
				<ul class="nav navbar-nav">
					<li class="active"><a href="#">Scores</a></li>
					<li><a href="#about">Questions</a></li>
					<li><a href="#contact">Contact</a></li>
				</ul>
			</div>
			<!--/.nav-collapse -->
		</div>
	</nav>

	<div class="container">
		<div class="jumbotron">
			<div class="collapse in qFrame" id="answerButtons">		
				<h1>Hello Girls!</h1>
			</div>
			<!--<div id="question"></div>-->					
			<p class="lead" id="question">Prêtes à jouer ?</p>
			<p class="lead" id="answer"></p>
			<div class="row collapse qFrame" id="answerButtons">
				<div class="col-xs-3">
					<input type="button" class="btn btn-lg btn-block btn-success" id="correct" value="Correct" onclick="correct()" />
				</div>
				<div class="col-xs-3">
					<input type="button" class="btn btn-lg btn-block btn-danger" id="incorrect" value="Incorrect" onclick="incorrect()" />
				</div>
			</div>						
		</div>
	</div>
	<!-- /.container -->

	<div class="container">
		<div class="row">
			<div class="col-xs-12">
				<div id="some_div"></div>
			</div>
		</div>
	</div>

	<div class="container">
		<section class="row">
			<div class="col-xs-1">
				<!--<p id="player0">Clara</p>-->
				<div id="player1">Clara</div>
			</div>
			<div class="col-xs-11">
				<div id="pg1" class="progress progress-striped active">
					<div id="pb1" class="progress-bar"></div>
					<div id="pourcentage" class="pull-right"></div>
				</div>
			</div>
			<div class="col-xs-1">
				<p id="player2">Inès</p>
			</div>
			<div class="col-xs-11">
				<div id="pg2" class="progress progress-striped active">
					<div id="pb2" class="progress-bar progress-bar-danger"></div>
					<div id="pourcentage" class="pull-right"></div>
				</div>
			</div>
			<div class="col-xs-1">
				<p id="player3">Dorian</p>
			</div>
			<div class="col-xs-11">
				<div id="pg3" class="progress progress-striped active">
					<div id="pb3" class="progress-bar progress-bar-warning"></div>
					<div id="pourcentage" class="pull-right"></div>
				</div>
			</div>
			<div class="col-xs-1">
				<p id="player4">Coline</p>
			</div>
			<div class="col-xs-11">
				<div id="pg4" class="progress progress-striped active">
					<div id="pb4" class="progress-bar progress-bar-perso"></div>
					<div id="pourcentage" class="pull-right"></div>
				</div>
			</div>
			<div class="col-xs-1">
				<p id="player5">Quentin</p>
			</div>
			<div class="col-xs-11">
				<div id="pg5" class="progress progress-striped active">
					<div id="pb5" class="progress-bar progress-bar-success"></div>
					<div id="pourcentage" class="pull-right"></div>
				</div>
			</div>
			<div class="col-xs-1">
				<p id="player6">Remy</p>
			</div>
			<div class="col-xs-11">
				<div id="pg6" class="progress progress-striped active">
					<div id="pb6" class="progress-bar progress-bar-info"></div>
					<div id="pourcentage" class="pull-right"></div>
				</div>
			</div>
			<div class="col-xs-offset-1">
				<!-- No need anymore 
				<input type="button" class="btn btn-primary" id="animer" value="Animer" />
                                -->
			</div>
		</section>
	</div>

	<br>

	<div class="container">
		<div class="row">		
			<div class="col-xs-12">
				<button class="btn btn-primary" id="startStop" data-toggle="collapse" data-target=".qFrame" onclick="startGame()">Débuter le jeu</button>
				<!--<button class="btn btn-primary" id="startStop" data-toggle="collapse" data-target="#answerButtons" onclick="startGame()">Débuter le jeu</button>-->
				<!--<input type="button" class="btn btn-primary" id="start" value="Débuter le jeu" onclick="getQuestion()" />-->
				<input type="button" class="btn btn-primary hidden" id="nextQ" value="Autre question" onclick="nextQ()" />				
			</div>
		</div>
	</div>

	<br>

	<div class="container">	
		<div class="col-xs-12">
			<div id="result"></div>
		</div>
		<div class="col-xs-12">
			<div id="console">
				<br>
			</div>
		</div>		
	</div>



	<a href="#user"  data-toggle="modal"  data-id="{$user['id']}">ModalTest</a>

	<div class="modal fade" id="user">
	    <div class="modal-header">
	        <button class="close" data-dismiss="modal">×</button>
	        <h3>Modal header</h3>
	    </div>
	    <div class="modal-body">
	        <p>Some code</p>
	    </div>
	</div>


	
	<script src="dist/js/jquery.js"></script>

	<script type="text/javascript">
		// Catch any button click
	    $(document).ready(function(){
	        $("button").click(function(){
	            /*
	            $.ajax({
	                type: 'POST',
	                url: 'your_page.php',
	                success: function(data) {
	                    alert(data);
	                    $("p").text(data);

	                }
	            });
	            //other method, also ajax
		        var clickBtnValue = $(this).val();
		        var ajaxurl = 'your_page.php',
		        data =  {'action': clickBtnValue};
		        $.post(ajaxurl, data, function (response) {
		            // Response div goes here.
		            alert("action performed successfully");
		        });
		        */	            
		   });
		});
	</script>
	


	<script>

	var currentQuestion = "";
	var currentAnswer = "";	
	var currentPlayerID = 0;

		function getDate(){
			var currentdate = new Date(); 
			var datetime = currentdate.getDate() + "/"
			             + (currentdate.getMonth()+1)  + "/" 
			             + currentdate.getFullYear() + " @ "  
			             + currentdate.getHours() + ":"  
			             + currentdate.getMinutes() + ":" 
			             + currentdate.getSeconds();
			 return datetime;

		}

		function getQuestion(){
			//show answers buttons (de-activated)
			$("#answerButtons").toggle();
			$("#correct").prop('disabled', true);
			$("#incorrect").prop('disabled', true);			
			alert ("le reste est à implémenter :)");
		}		

		function startGame(){
			document.getElementById("question").innerHTML = "Chargement of ze super game..";
			document.getElementById("startStop").innerHTML = "Arrêter le jeu";
			document.getElementById("startStop").onclick = stopGame;	

			//de-activate answers buttons
			$("#correct").prop('disabled', true);
			$("#incorrect").prop('disabled', true);
			$(".hidden").removeClass("hidden");

			startListeners();
		}

		function stopGame() {
			$("#startStop").prop('disabled', true);
			$("#nextQ").prop('disabled', true);
			$("#correct").prop('disabled', true);
			$("#incorrect").prop('disabled', true);
			$(".progress").removeClass("active");
		}			

		function closeConnection(source) {			

			source.close();
			//logger.log('> Connection was closed');
			//updateConnectionStatus('Disconnected', false);
			document.getElementById("result").innerHTML += "Connection arrêtée<br>";
		}	

		function startListeners(mode = "all"){	

			console.log("start " + mode + " listeners");
			
			//Events listener initiation

			if(typeof(EventSource) !== "undefined") {
				console.log("listening pig.php");
				var source = new EventSource("pig.php");
			} else {
				console.log("Browser does not support Server Sent Events");
				document.getElementById("result").innerHTML = "Désolé, ce jeu est beaucoup trop trendy. Votre navigateur ne le supporte pas.";
			}

			//Events listener start
			switch (mode) {
				case "all":
					listenQuestion(source);
					listenPlayer(source);
					break;
			    case "question":
					listenQuestion(source);
					break;
			    case "player":
					listenPlayer(source);
					break;
    			default:
					listenMessage(source);    			
					listenQuestion(source);
					listenPlayer(source);
			}			

		}

		function listenMessage(source){
			// Event listener for general message
			console.log("Listening for message..");			

			//source.onmessage = function(event) {
			//	document.getElementById("result").innerHTML += event.data + "<br>";
			//};
			//same, but with different listeners
			/*
			source.addEventListener("message",function(event){
				document.getElementById("result").innerHTML += event.data + "<br>";
			}, false);
			source.addEventListener("question",function(event){
				document.getElementById("question").innerHTML += event.data + "<br>";
			}, false);
			*/

			// in JSON format
			source.addEventListener("message", function(event) {
			  var data = JSON.parse(event.data);
			  //considering two vars, id & msg
			  console.log(data.id, data.msg);
			  //each message contains the lastEventId property
			  console.log(event.lastEventId);
			}, false);
		}

		function listenQuestion(source){
			// Event listener for question
			console.log("Listening for next question..");

			source.addEventListener("question",function(event){

				document.getElementById("result").innerHTML = "Last browser Question sync: " + getDate() + "<br>";
				document.getElementById("result").innerHTML += "Question last ID: " + event.lastEventId + "<br>";

				//var currentQuestion = event.data;
				console.log("question data to parse: " + event.data);
				var data = JSON.parse(event.data);
				currentQuestion = data.question;
				currentAnswer = data.answer;				
				console.log("New question: " + currentQuestion);				
				document.getElementById("question").innerHTML = "<b>Question: </b>" + currentQuestion;
				document.getElementById("answer").innerHTML = "<b>Réponse: </b>";				
				//document.getElementById("next").value = "Autre question";

				//de-activate answers buttons
				$("#correct").prop('disabled', true);
				$("#incorrect").prop('disabled', true);

			}, false);			
		}

		function listenPlayer(source){
			// Event listener for faster player
			console.log("Listening for faster player..");
			source.addEventListener("player",function(event){

				document.getElementById("result").innerHTML = "Last browser Player sync: " + getDate() + "<br>";
				document.getElementById("result").innerHTML += "Data brute: " + event.data + "<br>";

				currentPlayerID = event.data;
				// message in JSON format
				//var data = JSON.parse(event.data);
				//currentPlayerID = data.player;
				//var currentAnswer = data.answer;
				console.log("Faster player: " + currentPlayerID);								
				document.getElementById("answer").innerHTML = "<b>Réponse: </b>" + currentAnswer;
				document.getElementById("result").innerHTML += "Joueur " + currentPlayerID + " a la main.<br>";
				document.getElementById("result").innerHTML += "Réponse: " + currentAnswer + "<br>";


				//activate answers buttons
				$("#correct").prop('disabled', false);
				$("#incorrect").prop('disabled', false);

				//replace text
				//$("#player1").text("A toi");
				//Remove all glow style
				//Salut Thib, ça roule ? :)
				var playersEl = document.querySelectorAll(".glow");
				for (var i = 0; i < playersEl.length; i++) {
				    playersEl[i].classList.remove("glow");
				}
				//Add glow style to current player
				var thePlayerEl = document.querySelector("#player" + currentPlayerID);
				thePlayerEl.classList.add("glow");

				//Close connection
				closeConnection(source);

			}, false);
		}


		function nextQ(){
			//alert ("à implémenter :)");
			console.log("Other question");
			$("#correct").prop('disabled', true);
			$("#incorrect").prop('disabled', true);
			startListeners();
		}		

		//async function correct(){
		function correct(){
			console.log("Correct answer");
			$("#correct").prop('disabled', true);
			$("#incorrect").prop('disabled', true);		
			addPoints();
			//console.log('Taking a break...');
			//await sleep(1000);
			//console.log('One second later');
			startListeners();
		}

		function incorrect(){
			console.log("Incorrect answer, next player");
			$("#correct").prop('disabled', true);
			$("#incorrect").prop('disabled', true);
			startListeners("player");
		}

		function addPoints(){

			//var curWidth = $("#pb" + currentPlayerID).width();
			//var parentWidth = $("#pb" + currentPlayerID).offsetParent().width();
			//var curPoints = 100*curWidth/parentWidth;
			//currentPlayerID=1;
			var curPoints = Math.round($("#pb" + currentPlayerID).width() / $("#pb" + currentPlayerID).parent().width() * 100);
			document.getElementById("result").innerHTML += "Points actuel: " + curPoints + "<br>";
			var newPoints = curPoints + 20;
			//alert (newPoints);
			if (newPoints <= 100) {
				document.getElementById("result").innerHTML += "Nouveaux points: " + newPoints + "<br>";	
				document.getElementById("pb" + currentPlayerID).innerHTML = newPoints;
				// in jQuery
				$("#pb" + currentPlayerID).css("width", newPoints + "%");					
			}
			if (newPoints >= 100) {	
				$("#pg" + currentPlayerID).removeClass("active");
			}
		}

		//right way of doing a sleep
		//use of asynchronous function
		//await can only be executed in functions prefixed with the async keyword. Runkit wraps your code in an async function before executing it. 
		//await only pauses the current async function
		//the async/await feature lets the code explicitly wait for a promise to settle
		//note tha promises are not supported by IE (tiens tiens..)
		/*
		function sleep(ms) {
  			return new Promise(resolve => setTimeout(resolve, ms));
		}

		async function sleepDemo() {
			console.log('Taking a break...');
			await sleep(2000);
			console.log('Two second later');
		}
		*/
			
	</script>

	<script>
	// AJAX section to handle events from client's side
		// jQuery to catch any button click
		/*
		$(document).ready(function(){
		    $('.button').click(function(){
		    	alert("button clicked");

		        var clickBtnValue = $(this).val();
		        var ajaxurl = 'pig.php',
		        data =  {'action': clickBtnValue};
		        $.post(ajaxurl, data, function (response) {
		            // Response div goes here.
		            alert("action performed successfully");
		        });
		    });

		});	*/

	</script>

	<script>
		function timer(n) {
			var rand = randomIntFromInterval(1, 6);
			//$(".progress-bar").css("width", n + "%");
			$("#pb" + rand).css("width", n + "%");
			$("#pourcentage").text(n + "%");
			if (n < 100) {
				setTimeout(function() {
					timer(n + 10);
				}, 1000);
			}
		}
		function randomIntFromInterval(min, max) {
			return Math.floor(Math.random() * (max - min + 1) + min);
		}
		$(function() {
			$("#animer").click(function() {
				timer(0);
			});
		});
	</script>

	<!-- Bootstrap core JavaScript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<!--  jquery ..for later
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script> -->
    <script src="dist/js/bootstrap.min.js"></script>
	<!-- IE10 viewport hack for Surface/desktop Windows 8 bug 
	<script src="../../assets/js/ie10-viewport-bug-workaround.js"></script>-->

	<!-- For PhoneGap build
	<script type="text/javascript">
            app.initialize();
    </script>
-->
</body>
</html>





